<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meeting Room â€” Working Version</title>

<style>
  <header>
  <img src="logo.png" alt="Logo" style="height:30px; vertical-align:middle; margin-right:8px;">
  Simple Meeting Room
</header>

body {margin:0; font-family: Arial; background:#eef1f4; display:flex; flex-direction:column; height:100vh;}
header {background:#2563eb; color:white; padding:14px; text-align:center; font-size:22px;}
#videos {flex:1; display:flex; flex-wrap:wrap; justify-content:center; align-items:center; gap:12px; padding:12px; overflow:auto;}
video {width:300px; height:220px; border-radius:12px; background:black; object-fit:cover;}
#controls {display:flex; justify-content:center; gap:12px; padding:12px; background:#fff;}
input, button{padding:8px 12px; border-radius:6px; border:1px solid #ccc;}
button{background:#2563eb; color:white; cursor:pointer;}
button:hover{background:#1e4ecf;}
</style>
</head>
<body>

<header>Simple Meeting Room</header>

<div id="controls">
  <input type="text" id="roomId" placeholder="Enter room ID">
  <button id="joinBtn">Join Meeting</button>
</div>

<div id="videos"></div>

<script src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js"></script>
<script>
const videoContainer = document.getElementById("videos");
const joinBtn = document.getElementById("joinBtn");
const roomInput = document.getElementById("roomId");

let myStream;
let myPeer;
let socket;
let peers = {};

async function initMedia() {
  myStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
  const myVideo = document.createElement("video");
  myVideo.srcObject = myStream;
  myVideo.muted = true;
  myVideo.autoplay = true;
  videoContainer.appendChild(myVideo);
}

joinBtn.onclick = () => {
  const room = roomInput.value.trim();
  if (!room) return alert("Enter room ID");
  joinRoom(room);
};

function joinRoom(roomId) {
  socket = new WebSocket("wss://socketsbay.com/wss/v2/1/demo/");
  
  myPeer = new Peer(undefined, { host: "0.peerjs.com", port: 443, secure: true });

  myPeer.on("open", id => {
    socket.send(JSON.stringify({ type: "join", room: roomId, peerId: id }));
    alert("Share this Room ID: " + roomId);
  });

  socket.onmessage = (msg) => {
    const data = JSON.parse(msg.data);
    if (data.type === "user-joined" && data.peerId !== myPeer.id) {
      connectToNewUser(data.peerId);
    }
  };

  myPeer.on("call", call => {
    call.answer(myStream);
    const vid = document.createElement("video");
    call.on("stream", remoteStream => {
      vid.srcObject = remoteStream;
      vid.autoplay = true;
      videoContainer.appendChild(vid);
    });
    call.on("close", () => vid.remove());
    peers[call.peer] = call;
  });
}

function connectToNewUser(peerId) {
  const call = myPeer.call(peerId, myStream);
  const vid = document.createElement("video");
  call.on("stream", remoteStream => {
    vid.srcObject = remoteStream;
    vid.autoplay = true;
    videoContainer.appendChild(vid);
  });
  call.on("close", () => vid.remove());
  peers[peerId] = call;
}

initMedia();
</script>
</body>
</html>

